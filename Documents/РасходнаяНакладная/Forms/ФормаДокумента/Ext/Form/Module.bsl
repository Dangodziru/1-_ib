&НаКлиенте
Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
	СТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	Если СТЧ <> Неопределено Тогда
		РаботаСДокументами.РассчитатьСумму(СТЧ);
		РассчитатьСуммуДокумента();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
	СТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	Если СТЧ <> Неопределено Тогда
		РаботаСДокументами.РассчитатьСумму(СТЧ);
		РассчитатьСуммуДокумента();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыПриИзменении(Элемент)
	РассчитатьСуммуДокумента();
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыПриУдаленииСтрок(Элемент, УдаленныеСтроки)
	РассчитатьСуммуДокумента();
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыПослеДобавленияСтрок(Элемент, НовыеСтроки)
	РассчитатьСуммуДокумента();
КонецПроцедуры


&НаКлиенте
Процедура РассчитатьСуммуДокумента()
	Попытка
		СуммаНоменклатуры = 0;
		СуммаУслуг = 0;
		
		// Считаем сумму из таблицы СписокНоменклатуры
		Если Объект.СписокНоменклатуры <> Неопределено И Объект.СписокНоменклатуры.Количество() > 0 Тогда
			СуммаНоменклатуры = Объект.СписокНоменклатуры.Итог("Сумма");
		КонецЕсли;
		
		// Считаем сумму из таблицы Услуги
		Если Объект.Услуги <> Неопределено И Объект.Услуги.Количество() > 0 Тогда
			СуммаУслуг = Объект.Услуги.Итог("Сумма");
		КонецЕсли;
		
		// Устанавливаем итоговую сумму
		Объект.СуммаПоДокументу = СуммаНоменклатуры + СуммаУслуг;
		Модифицированность = Истина;
		
	Исключение
		Сообщить("Ошибка при расчёте суммы: " + ОписаниеОшибки());
	КонецПопытки;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	РассчитатьСуммуДокумента();
КонецПроцедуры